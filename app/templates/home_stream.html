{% extends "layout.html" %}
{% block title %}COMBATE RASANTE - Central de Atividades{% endblock %}

{% block content %}

<!-- Intro vídeo (5s) -->
<div id="intro-video" aria-hidden="true">
  <video id="introVideoEl" autoplay muted playsinline preload="auto">
    <source src="{{ url_for('static', filename='video/intro.mp4') }}" type="video/mp4">
  </video>
</div>

<link rel="stylesheet" href="{{ url_for('static', filename='css/home_stream.css') }}">

<section class="home-stream-hero">
  <div class="home-stream-overlay"></div>

  <div class="home-stream-container"><!-- TÍTULO / SUBTÍTULO (mantém o que você já ajustou no CSS) -->
    <h1 class="home-stream-title">COMBATE RASANTE</h1>
    <p class="home-stream-subtitle">
      Aplicação Aérea de <span class="alta-precisao">Alta Precisão</span>
    </p>

    <div class="home-stream-pill">
      Central de Atividades
    </div>


    <!-- CARROSSEL 3 CARDS (estilo Netflix) -->
    <div class="stream-carousel" aria-label="Carrossel de seções">
      <button class="stream-arrow stream-prev" type="button" aria-label="Anterior">‹</button>

      <div class="stream-track" id="streamTrack">
        <!-- Os cards são renderizados via JS -->
      </div>

      <button class="stream-arrow stream-next" type="button" aria-label="Próximo">›</button>
    </div>

    <div class="stream-dots" id="streamDots" aria-hidden="true"></div>

  </div>
</section>

<script src="{{ url_for('static', filename='js/home_stream.js') }}"></script>

<script>
(function () {
  const INTRO_KEY = "cr_intro_shown";

  const wrap = document.getElementById("intro-video");
  const vid = document.getElementById("introVideoEl");
  if (!wrap || !vid) return;

  // ✅ Se já mostrou nesta sessão, não exibe de novo
  if (sessionStorage.getItem(INTRO_KEY) === "1") {
    wrap.remove();
    return;
  }

  // ✅ Marca como já mostrado
  sessionStorage.setItem(INTRO_KEY, "1");

  // trava scroll
  document.documentElement.classList.add("intro-lock");
  document.body.classList.add("intro-lock");

  let done = false;
  function finish() {
    if (done) return;
    done = true;

    wrap.classList.add("hide");
    document.documentElement.classList.remove("intro-lock");
    document.body.classList.remove("intro-lock");

    // remove do DOM após o fade
    setTimeout(() => {
      wrap.remove();
    }, 900);
  }

  // some após 5s ou quando o vídeo acabar
  setTimeout(finish, 5000);
  vid.addEventListener("ended", finish);
})();
</script>
{% endblock %}
